{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"axios","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":26,"index":26}}],"key":"e45rENb5cSu0Yeh6oC1uWb7lEp4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  Object.defineProperty(exports, \"api\", {\n    enumerable: true,\n    get: function () {\n      return api;\n    }\n  });\n  Object.defineProperty(exports, \"setAuthToken\", {\n    enumerable: true,\n    get: function () {\n      return setAuthToken;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _axios = require(_dependencyMap[1], \"axios\");\n  var axios = _interopDefault(_axios);\n  const API_URL = _expoVirtualEnv.env.EXPO_PUBLIC_BACKEND_URL || 'https://gps-pilot.preview.emergentagent.com';\n  const api = axios.default.create({\n    baseURL: `${API_URL}/api`,\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    withCredentials: true\n  });\n\n  // Add auth token to requests\n  let authToken = null;\n  const setAuthToken = token => {\n    authToken = token;\n    if (token) {\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      console.log('‚úÖ Auth token set in API headers');\n    } else {\n      delete api.defaults.headers.common['Authorization'];\n      console.log('üîì Auth token removed from API headers');\n    }\n  };\n\n  // Function to restore token from localStorage\n  const restoreAuthToken = () => {\n    if (typeof window !== 'undefined' && window.localStorage) {\n      const storedToken = localStorage.getItem('sessionToken');\n      if (storedToken && !authToken) {\n        setAuthToken(storedToken);\n        console.log('üîÑ Auth token restored from localStorage');\n      }\n    }\n  };\n\n  // Restore token on module load\n  restoreAuthToken();\n\n  // Add request interceptor to ensure token is always present\n  api.interceptors.request.use(config => {\n    // If no auth header but we have token in localStorage, restore it\n    if (!config.headers.Authorization) {\n      restoreAuthToken();\n    }\n    return config;\n  }, error => {\n    return Promise.reject(error);\n  });\n\n  // Multiple event listeners for better browser compatibility\n  if (typeof window !== 'undefined') {\n    // Primary: visibilitychange (modern browsers)\n    document.addEventListener('visibilitychange', () => {\n      if (!document.hidden) {\n        restoreAuthToken();\n        console.log('üëÅÔ∏è Tab visible (visibilitychange) - auth token checked');\n      }\n    });\n\n    // Backup: focus event (when window regains focus)\n    window.addEventListener('focus', () => {\n      restoreAuthToken();\n      console.log('üëÅÔ∏è Window focused - auth token checked');\n    });\n\n    // Additional: pageshow (when page becomes visible, including from cache)\n    window.addEventListener('pageshow', event => {\n      if (event.persisted) {\n        // Page loaded from cache (bfcache)\n        restoreAuthToken();\n        console.log('üëÅÔ∏è Page shown from cache - auth token checked');\n      }\n    });\n  }\n  var _default = api;\n});","lineCount":106,"map":[[12,2,82,0,"Object"],[12,8,82,0],[12,9,82,0,"defineProperty"],[12,23,82,0],[12,24,82,0,"exports"],[12,31,82,0],[13,4,82,0,"enumerable"],[13,14,82,0],[14,4,82,0,"get"],[14,7,82,0],[14,18,82,0,"get"],[14,19,82,0],[15,6,82,0],[15,13,82,0,"_default"],[15,21,82,0],[16,4,82,0],[17,2,82,0],[18,2,6,0,"Object"],[18,8,6,0],[18,9,6,0,"defineProperty"],[18,23,6,0],[18,24,6,0,"exports"],[18,31,6,0],[19,4,6,0,"enumerable"],[19,14,6,0],[20,4,6,0,"get"],[20,7,6,0],[20,18,6,0,"get"],[20,19,6,0],[21,6,6,0],[21,13,6,0,"api"],[21,16,6,0],[22,4,6,0],[23,2,6,0],[24,2,17,0,"Object"],[24,8,17,0],[24,9,17,0,"defineProperty"],[24,23,17,0],[24,24,17,0,"exports"],[24,31,17,0],[25,4,17,0,"enumerable"],[25,14,17,0],[26,4,17,0,"get"],[26,7,17,0],[26,18,17,0,"get"],[26,19,17,0],[27,6,17,0],[27,13,17,0,"setAuthToken"],[27,25,17,0],[28,4,17,0],[29,2,17,0],[30,2,26,2],[30,6,26,2,"_expoVirtualEnv"],[30,21,26,2],[30,24,26,2,"require"],[30,31,26,2],[30,32,26,2,"_dependencyMap"],[30,46,26,2],[31,2,1,0],[31,6,1,0,"_axios"],[31,12,1,0],[31,15,1,0,"require"],[31,22,1,0],[31,23,1,0,"_dependencyMap"],[31,37,1,0],[32,2,1,0],[32,6,1,0,"axios"],[32,11,1,0],[32,14,1,0,"_interopDefault"],[32,29,1,0],[32,30,1,0,"_axios"],[32,36,1,0],[33,2,4,0],[33,8,4,6,"API_URL"],[33,15,4,13],[33,18,4,16,"_expoVirtualEnv"],[33,33,4,16],[33,34,4,16,"env"],[33,37,4,16],[33,38,4,16,"EXPO_PUBLIC_BACKEND_URL"],[33,61,4,16],[33,65,4,55],[33,110,4,100],[34,2,6,7],[34,8,6,13,"api"],[34,11,6,16],[34,14,6,19,"axios"],[34,19,6,24],[34,20,6,24,"default"],[34,27,6,24],[34,28,6,25,"create"],[34,34,6,31],[34,35,6,32],[35,4,7,2,"baseURL"],[35,11,7,9],[35,13,7,11],[35,16,7,14,"API_URL"],[35,23,7,21],[35,29,7,27],[36,4,8,2,"headers"],[36,11,8,9],[36,13,8,11],[37,6,9,4],[37,20,9,18],[37,22,9,20],[38,4,10,2],[38,5,10,3],[39,4,11,2,"withCredentials"],[39,19,11,17],[39,21,11,19],[40,2,12,0],[40,3,12,1],[40,4,12,2],[42,2,14,0],[43,2,15,0],[43,6,15,4,"authToken"],[43,15,15,28],[43,18,15,31],[43,22,15,35],[44,2,17,7],[44,8,17,13,"setAuthToken"],[44,20,17,25],[44,23,17,29,"token"],[44,28,17,49],[44,32,17,54],[45,4,18,2,"authToken"],[45,13,18,11],[45,16,18,14,"token"],[45,21,18,19],[46,4,19,2],[46,8,19,6,"token"],[46,13,19,11],[46,15,19,13],[47,6,20,4,"api"],[47,9,20,7],[47,10,20,8,"defaults"],[47,18,20,16],[47,19,20,17,"headers"],[47,26,20,24],[47,27,20,25,"common"],[47,33,20,31],[47,34,20,32],[47,49,20,47],[47,50,20,48],[47,53,20,51],[47,63,20,61,"token"],[47,68,20,66],[47,70,20,68],[48,6,21,4,"console"],[48,13,21,11],[48,14,21,12,"log"],[48,17,21,15],[48,18,21,16],[48,51,21,49],[48,52,21,50],[49,4,22,2],[49,5,22,3],[49,11,22,9],[50,6,23,4],[50,13,23,11,"api"],[50,16,23,14],[50,17,23,15,"defaults"],[50,25,23,23],[50,26,23,24,"headers"],[50,33,23,31],[50,34,23,32,"common"],[50,40,23,38],[50,41,23,39],[50,56,23,54],[50,57,23,55],[51,6,24,4,"console"],[51,13,24,11],[51,14,24,12,"log"],[51,17,24,15],[51,18,24,16],[51,58,24,56],[51,59,24,57],[52,4,25,2],[53,2,26,0],[53,3,26,1],[55,2,28,0],[56,2,29,0],[56,8,29,6,"restoreAuthToken"],[56,24,29,22],[56,27,29,25,"restoreAuthToken"],[56,28,29,25],[56,33,29,31],[57,4,30,2],[57,8,30,6],[57,15,30,13,"window"],[57,21,30,19],[57,26,30,24],[57,37,30,35],[57,41,30,39,"window"],[57,47,30,45],[57,48,30,46,"localStorage"],[57,60,30,58],[57,62,30,60],[58,6,31,4],[58,12,31,10,"storedToken"],[58,23,31,21],[58,26,31,24,"localStorage"],[58,38,31,36],[58,39,31,37,"getItem"],[58,46,31,44],[58,47,31,45],[58,61,31,59],[58,62,31,60],[59,6,32,4],[59,10,32,8,"storedToken"],[59,21,32,19],[59,25,32,23],[59,26,32,24,"authToken"],[59,35,32,33],[59,37,32,35],[60,8,33,6,"setAuthToken"],[60,20,33,18],[60,21,33,19,"storedToken"],[60,32,33,30],[60,33,33,31],[61,8,34,6,"console"],[61,15,34,13],[61,16,34,14,"log"],[61,19,34,17],[61,20,34,18],[61,62,34,60],[61,63,34,61],[62,6,35,4],[63,4,36,2],[64,2,37,0],[64,3,37,1],[66,2,39,0],[67,2,40,0,"restoreAuthToken"],[67,18,40,16],[67,19,40,17],[67,20,40,18],[69,2,42,0],[70,2,43,0,"api"],[70,5,43,3],[70,6,43,4,"interceptors"],[70,18,43,16],[70,19,43,17,"request"],[70,26,43,24],[70,27,43,25,"use"],[70,30,43,28],[70,31,44,3,"config"],[70,37,44,9],[70,41,44,14],[71,4,45,4],[72,4,46,4],[72,8,46,8],[72,9,46,9,"config"],[72,15,46,15],[72,16,46,16,"headers"],[72,23,46,23],[72,24,46,24,"Authorization"],[72,37,46,37],[72,39,46,39],[73,6,47,6,"restoreAuthToken"],[73,22,47,22],[73,23,47,23],[73,24,47,24],[74,4,48,4],[75,4,49,4],[75,11,49,11,"config"],[75,17,49,17],[76,2,50,2],[76,3,50,3],[76,5,51,3,"error"],[76,10,51,8],[76,14,51,13],[77,4,52,4],[77,11,52,11,"Promise"],[77,18,52,18],[77,19,52,19,"reject"],[77,25,52,25],[77,26,52,26,"error"],[77,31,52,31],[77,32,52,32],[78,2,53,2],[78,3,54,0],[78,4,54,1],[80,2,56,0],[81,2,57,0],[81,6,57,4],[81,13,57,11,"window"],[81,19,57,17],[81,24,57,22],[81,35,57,33],[81,37,57,35],[82,4,58,2],[83,4,59,2,"document"],[83,12,59,10],[83,13,59,11,"addEventListener"],[83,29,59,27],[83,30,59,28],[83,48,59,46],[83,50,59,48],[83,56,59,54],[84,6,60,4],[84,10,60,8],[84,11,60,9,"document"],[84,19,60,17],[84,20,60,18,"hidden"],[84,26,60,24],[84,28,60,26],[85,8,61,6,"restoreAuthToken"],[85,24,61,22],[85,25,61,23],[85,26,61,24],[86,8,62,6,"console"],[86,15,62,13],[86,16,62,14,"log"],[86,19,62,17],[86,20,62,18],[86,77,62,75],[86,78,62,76],[87,6,63,4],[88,4,64,2],[88,5,64,3],[88,6,64,4],[90,4,66,2],[91,4,67,2,"window"],[91,10,67,8],[91,11,67,9,"addEventListener"],[91,27,67,25],[91,28,67,26],[91,35,67,33],[91,37,67,35],[91,43,67,41],[92,6,68,4,"restoreAuthToken"],[92,22,68,20],[92,23,68,21],[92,24,68,22],[93,6,69,4,"console"],[93,13,69,11],[93,14,69,12,"log"],[93,17,69,15],[93,18,69,16],[93,59,69,57],[93,60,69,58],[94,4,70,2],[94,5,70,3],[94,6,70,4],[96,4,72,2],[97,4,73,2,"window"],[97,10,73,8],[97,11,73,9,"addEventListener"],[97,27,73,25],[97,28,73,26],[97,38,73,36],[97,40,73,39,"event"],[97,45,73,44],[97,49,73,49],[98,6,74,4],[98,10,74,8,"event"],[98,15,74,13],[98,16,74,14,"persisted"],[98,25,74,23],[98,27,74,25],[99,8,75,6],[100,8,76,6,"restoreAuthToken"],[100,24,76,22],[100,25,76,23],[100,26,76,24],[101,8,77,6,"console"],[101,15,77,13],[101,16,77,14,"log"],[101,19,77,17],[101,20,77,18],[101,68,77,66],[101,69,77,67],[102,6,78,4],[103,4,79,2],[103,5,79,3],[103,6,79,4],[104,2,80,0],[105,2,82,0],[105,6,82,0,"_default"],[105,14,82,0],[105,17,82,15,"api"],[105,20,82,18],[106,0,82,19],[106,3]],"functionMap":{"names":["<global>","setAuthToken","restoreAuthToken","interceptors.request.use$argument_0","interceptors.request.use$argument_1","document.addEventListener$argument_1","window.addEventListener$argument_1"],"mappings":"AAA;4BCgB;CDS;yBEG;CFQ;EGO;GHM;EIC;GJE;gDKM;GLK;mCMG;GNG;sCMG;GNM"},"hasCjsExports":false},"type":"js/module"}]}